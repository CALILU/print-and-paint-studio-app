<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print and Paint Studio - GestiÃ³n de Videos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        .sidebar {
            background-color: #343a40;
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
        }
        .sidebar a {
            color: #ced4da;
            text-decoration: none;
            display: block;
            padding: 10px 15px;
            transition: all 0.3s;
        }
        .sidebar a:hover {
            background-color: #495057;
            color: white;
        }
        .sidebar a.active {
            background-color: #dc3545;
            color: white;
        }
        .sidebar-heading {
            padding: 0 15px 20px 15px;
            font-size: 1.2rem;
            border-bottom: 1px solid #495057;
            margin-bottom: 20px;
        }
        .content {
            padding: 20px;
            margin-left: 250px;
        }
        .content-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .card {
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #dc3545;
            color: white;
        }
        .admin-badge {
            background-color: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .btn-primary {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .btn-primary:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .video-container {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .video-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .video-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .youtube-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .youtube-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .technique-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #dc3545;
            transition: all 0.3s;
        }
        .technique-item:hover {
            background-color: #f1f1f1;
            border-left-width: 5px;
        }
        .badge-beginner {
            background-color: #28a745;
        }
        .badge-intermediate {
            background-color: #fd7e14;
        }
        .badge-expert {
            background-color: #dc3545;
        }
        .techniques-container {
            max-height: 250px;
            overflow-y: auto;
        }
        .technique-item a {
            color: inherit;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.2s;
        }
        .technique-item a:hover {
            color: #dc3545;
            text-decoration: underline;
        }
        .technique-highlight {
            background-color: rgba(220, 53, 69, 0.1);
            border-left-color: #dc3545;
            font-weight: bold;
        }
        .time-selector {
            display: inline-block;
            background-color: #f8d7da;
            color: #721c24;
            padding: 3px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .time-selector:hover {
            background-color: #721c24;
            color: white;
            transform: scale(1.05);
        }
        .time-text {
            font-weight: bold;
        }
        .technique-content {
            margin-bottom: 8px;
        }
        .tab-content {
            padding: 20px 0;
        }
        .nav-pills .nav-link.active {
            background-color: #dc3545;
        }
        .nav-pills .nav-link {
            color: #495057;
        }
        .form-section {
            border-left: 3px solid #dc3545;
            padding-left: 15px;
            margin-bottom: 20px;
        }
        .drag-drop-area {
            border: 2px dashed #dee2e6;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            background-color: #f8f9fa;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .drag-drop-area:hover {
            border-color: #dc3545;
            background-color: #f8f9fa;
        }
        .drag-drop-area.dragover {
            border-color: #28a745;
            background-color: #e8f5e9;
        }
        .checkbox-filter {
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            margin-bottom: 15px;
        }
        .category-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .category-pill {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            background-color: #f1f1f1;
            cursor: pointer;
            transition: all 0.2s;
        }
        .category-pill:hover, .category-pill.active {
            background-color: #dc3545;
            color: white;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .empty-message {
            background-color: #f8f9fa;
            padding: 50px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
        }
        .filter-chip {
            display: inline-block;
            background-color: #e9ecef;
            color: #495057;
            border-radius: 16px;
            padding: 5px 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }
        .filter-chip .close {
            margin-left: 8px;
            cursor: pointer;
        }
        .tooltip-inner {
            max-width: 200px;
            padding: 8px 10px;
            color: #fff;
            text-align: center;
            background-color: #dc3545;
            border-radius: 4px;
        }
        .form-floating {
            margin-bottom: 15px;
        }
        .thumbnail-preview {
            width: 100%;
            height: 180px;
            background-color: #e9ecef;
            background-position: center;
            background-size: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .technique-tag {
            display: inline-block;
            background-color: #f8f9fa;
            color: #495057;
            padding: 3px 10px;
            border-radius: 3px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.85rem;
            border: 1px solid #dee2e6;
        }
        .video-actions {
            opacity: 0;
            transition: opacity 0.2s;
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0,0,0,0.5);
            border-radius: 4px;
            padding: 5px;
        }
        .video-container:hover .video-actions {
            opacity: 1;
        }
        .action-icon {
            color: white;
            margin: 0 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .batch-actions {
            display: none;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .content {
                margin-left: 0;
            }
            .video-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="sidebar-heading">
                    Print and Paint Studio <span class="admin-badge">ADMIN</span>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                            <i class="bi bi-speedometer2 me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('admin_videos') }}">
                            <i class="bi bi-collection-play me-2"></i> GestiÃ³n de Videos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_users') }}">
                            <i class="bi bi-people me-2"></i> GestiÃ³n de Usuarios
                        </a>
                    </li>
                    <li class="nav-item mt-5">
                        <a class="nav-link" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-left me-2"></i> Cerrar SesiÃ³n
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 content">
                <div class="content-header">
                    <h1>GestiÃ³n de Videos</h1>
                    <p>Administra los videos de tÃ©cnicas de pintura para modelos 3D en resina</p>
                </div>
                
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <!-- Navigation Tabs -->
                <ul class="nav nav-pills mb-4" id="adminVideosTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="video-list-tab" data-bs-toggle="pill" data-bs-target="#video-list" type="button" role="tab" aria-controls="video-list" aria-selected="true">
                            <i class="bi bi-grid me-1"></i> Videos
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="add-video-tab" data-bs-toggle="pill" data-bs-target="#add-video" type="button" role="tab" aria-controls="add-video" aria-selected="false">
                            <i class="bi bi-plus-circle me-1"></i> AÃ±adir Video
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="techniques-tab" data-bs-toggle="pill" data-bs-target="#techniques" type="button" role="tab" aria-controls="techniques" aria-selected="false" style="display: none;">
                            <i class="bi bi-list-check me-1"></i> TÃ©cnicas
                        </button>
                    </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content" id="adminVideosTabsContent">
                    <!-- Videos List Tab -->
                    <div class="tab-pane fade show active" id="video-list" role="tabpanel" aria-labelledby="video-list-tab">
                        <!-- Search and filters -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <i class="bi bi-search me-2"></i> Buscar y Filtrar Videos
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="searchInput" placeholder="Buscar por tÃ­tulo, descripciÃ³n o canal...">
                                            <button class="btn btn-primary" type="button" onclick="searchVideos()">
                                                <i class="bi bi-search"></i> Buscar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <button class="btn btn-outline-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters" aria-expanded="false" aria-controls="advancedFilters">
                                            <i class="bi bi-funnel"></i> Filtros avanzados
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="collapse" id="advancedFilters">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-bold">Filtrar por categorÃ­a:</label>
                                            <div class="category-selector">
                                                <div class="category-pill active" data-category="all">Todas</div>
                                                <div class="category-pill" data-category="Sin categorÃ­a">Sin categorÃ­a</div>
                                                <div class="category-pill" data-category="Pintura Base">Pintura Base</div>
                                                <div class="category-pill" data-category="Sombreado">Sombreado</div>
                                                <div class="category-pill" data-category="IluminaciÃ³n">IluminaciÃ³n</div>
                                                <div class="category-pill" data-category="Detalles">Detalles</div>
                                                <div class="category-pill" data-category="Efectos Especiales">Efectos Especiales</div>
                                                <div class="category-pill" data-category="Barnizado">Barnizado</div>
                                                <div class="category-pill" data-category="Peanas">Peanas</div>
                                                <div class="category-pill" data-category="Otros">Otros</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-bold">Filtrar por dificultad:</label>
                                            <div class="category-selector">
                                                <div class="category-pill active" data-difficulty="all">Todos</div>
                                                <div class="category-pill" data-difficulty="beginner">Principiante</div>
                                                <div class="category-pill" data-difficulty="intermediate">Intermedio</div>
                                                <div class="category-pill" data-difficulty="expert">Experto</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="checkbox-filter">
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" id="filterHasTechniques">
                                                    <label class="form-check-label" for="filterHasTechniques">Solo videos con tÃ©cnicas</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" id="filterNoTechniques">
                                                    <label class="form-check-label" for="filterNoTechniques">Solo videos sin tÃ©cnicas</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="activeFilters" class="mt-3"></div>
                                    
                                    <div class="d-flex justify-content-end mt-3">
                                        <button class="btn btn-secondary me-2" onclick="clearFilters()">Limpiar filtros</button>
                                        <button class="btn btn-primary" onclick="applyFilters()">Aplicar filtros</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Batch actions -->
                        <div class="batch-actions" id="batchActions">
                            <div class="alert alert-info d-flex justify-content-between align-items-center">
                                <div>
                                    <span id="selectedCount">0</span> videos seleccionados
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-danger me-2" onclick="deleteSelectedVideos()">
                                        <i class="bi bi-trash"></i> Eliminar seleccionados
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="clearSelection()">
                                        <i class="bi bi-x"></i> Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Videos display -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h3>Videos <span class="badge bg-secondary" id="videoCount">0</span></h3>
                            <div class="btn-group">
                                <button id="gridViewBtn" class="btn btn-outline-secondary active" onclick="setViewMode('grid')">
                                    <i class="bi bi-grid"></i>
                                </button>
                                <button id="listViewBtn" class="btn btn-outline-secondary" onclick="setViewMode('list')">
                                    <i class="bi bi-list"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div id="videos-container" class="video-grid">
                            <div class="empty-message">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-3">Cargando videos...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add/Edit Video Tab -->
                    <div class="tab-pane fade" id="add-video" role="tabpanel" aria-labelledby="add-video-tab">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-plus-circle me-2"></i> <span id="form-title">AÃ±adir Nuevo Video</span>
                            </div>
                            <div class="card-body">
                                <form id="videoForm">
                                    <input type="hidden" id="video_id_edit" value="">
                                    
                                    <!-- Main video info -->
                                    <div class="form-section">
                                        <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i> InformaciÃ³n General</h5>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    <input type="text" class="form-control" id="title" placeholder="TÃ­tulo del video" required>
                                                    <label for="title">TÃ­tulo*</label>
                                                </div>
                                                
                                                <div class="form-floating mb-3">
                                                    <input type="text" class="form-control" id="youtube_id" placeholder="ID de YouTube" required>
                                                    <label for="youtube_id">ID de YouTube*</label>
                                                    <div class="form-text">Ej: dQw4w9WgXcQ (de https://www.youtube.com/watch?v=dQw4w9WgXcQ)</div>
                                                </div>
                                                
                                                <div class="form-floating mb-3">
                                                    <input type="text" class="form-control" id="channel" placeholder="Canal">
                                                    <label for="channel">Canal</label>
                                                </div>
                                            </div>
                                            
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    <textarea class="form-control" id="description" placeholder="DescripciÃ³n" style="height: 100px"></textarea>
                                                    <label for="description">DescripciÃ³n</label>
                                                </div>
                                                
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <select class="form-select" id="category">
                                                                <option value="Sin categorÃ­a">Sin categorÃ­a</option>
                                                                <option value="Pintura Base">Pintura Base</option>
                                                                <option value="Sombreado">Sombreado</option>
                                                                <option value="IluminaciÃ³n">IluminaciÃ³n</option>
                                                                <option value="Detalles">Detalles</option>
                                                                <option value="Efectos Especiales">Efectos Especiales</option>
                                                                <option value="Barnizado">Barnizado</option>
                                                                <option value="Peanas">Peanas</option>
                                                                <option value="Otros">Otros</option>
                                                            </select>
                                                            <label for="category">CategorÃ­a</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-floating mb-3">
                                                            <select class="form-select" id="difficulty_level">
                                                                <option value="beginner">Principiante</option>
                                                                <option value="intermediate">Intermedio</option>
                                                                <option value="expert">Experto</option>
                                                            </select>
                                                            <label for="difficulty_level">Nivel de Dificultad</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Technique timing -->
                                    <div class="form-section">
                                        <h5 class="mb-3"><i class="bi bi-clock me-2"></i> Tiempo de TÃ©cnica Principal</h5>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Tiempo inicial</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" id="technique_start_time_min" min="0" placeholder="Minutos">
                                                    <span class="input-group-text">:</span>
                                                    <input type="number" class="form-control" id="technique_start_time_sec" min="0" max="59" placeholder="Segundos">
                                                    <input type="hidden" id="technique_start_time" value="0">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Tiempo final</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" id="technique_end_time_min" min="0" placeholder="Minutos">
                                                    <span class="input-group-text">:</span>
                                                    <input type="number" class="form-control" id="technique_end_time_sec" min="0" max="59" placeholder="Segundos">
                                                    <input type="hidden" id="technique_end_time" value="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Preview -->
                                    <div class="form-section">
                                        <h5 class="mb-3"><i class="bi bi-eye me-2"></i> Vista Previa</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div id="thumbnailPreview" class="thumbnail-preview">
                                                    <div class="d-flex justify-content-center align-items-center h-100">
                                                        <span class="text-muted">La miniatura se generarÃ¡ automÃ¡ticamente</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div id="videoDataPreview">
                                                    <p class="text-muted">Ingresa la informaciÃ³n del video para ver una vista previa.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="button" class="btn btn-secondary" onclick="resetForm()">Cancelar</button>
                                        <button type="submit" class="btn btn-primary" id="submit-btn">Guardar Video</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Techniques Tab -->
                    <div class="tab-pane fade" id="techniques" role="tabpanel" aria-labelledby="techniques-tab">
                        <div class="card mb-4">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <i class="bi bi-list-check me-2"></i> TÃ©cnicas del Video
                                    </div>
                                    <div id="videoTitleDisplay" class="fw-bold"></div>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- Video preview for techniques -->
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <div class="youtube-container">
                                            <iframe id="techniquesVideoPreview" src="" frameborder="0" allowfullscreen></iframe>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div id="techniqueTiming" class="mb-3">
                                            <div class="alert alert-info">
                                                <i class="bi bi-info-circle me-2"></i> Selecciona una tÃ©cnica para ver la demostraciÃ³n en el video.
                                            </div>
                                        </div>
                                        <button class="btn btn-primary" id="captureTimeBtn" onclick="captureCurrentTime()">
                                            <i class="bi bi-clock"></i> Capturar tiempo actual
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Add new technique -->
                                <div class="form-section">
                                    <h5 class="mb-3"><i class="bi bi-plus-circle me-2"></i> AÃ±adir Nueva TÃ©cnica</h5>
                                    <form id="techniqueForm">
                                        <input type="hidden" id="technique_id_edit" value="">
                                        <input type="hidden" id="technique_video_id" value="">
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-floating mb-3">
                                                    <input type="text" class="form-control" id="technique_name" placeholder="Nombre de la tÃ©cnica" required>
                                                    <label for="technique_name">Nombre de la TÃ©cnica*</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Tiempo Inicial*</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" id="technique_start_min" min="0" placeholder="Min" required>
                                                    <span class="input-group-text">:</span>
                                                    <input type="number" class="form-control" id="technique_start_sec" min="0" max="59" placeholder="Seg" required>
                                                    <input type="hidden" id="technique_start" value="0">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <label class="form-label">Tiempo Final*</label>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" id="technique_end_min" min="0" placeholder="Min" required>
                                                    <span class="input-group-text">:</span>
                                                    <input type="number" class="form-control" id="technique_end_sec" min="0" max="59" placeholder="Seg" required>
                                                    <input type="hidden" id="technique_end" value="0">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex justify-content-end">
                                            <button type="button" class="btn btn-secondary me-2" onclick="resetTechniqueForm()">Cancelar</button>
                                            <button type="submit" class="btn btn-primary" id="technique-submit-btn">AÃ±adir TÃ©cnica</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Existing techniques -->
                                <div class="form-section mt-4">
                                    <h5 class="mb-3"><i class="bi bi-list-ul me-2"></i> TÃ©cnicas Existentes</h5>
                                    <div class="techniques-container" id="techniques-list">
                                        <div class="alert alert-info">No hay tÃ©cnicas asociadas a este video.</div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button type="button" class="btn btn-secondary" onclick="goBackToVideos()">
                                        <i class="bi bi-arrow-left"></i> Volver a Videos
                                    </button>
                                    <button type="button" class="btn btn-primary" onclick="finishEditingTechniques()">
                                        <i class="bi bi-check-circle"></i> Finalizar EdiciÃ³n
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Preview Modal -->
                <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="previewModalLabel">Vista Previa</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="youtube-container">
                                    <iframe id="previewIframe" src="" frameborder="0" allowfullscreen></iframe>
                                </div>
                                <div class="mt-3">
                                    <h6>TÃ©cnicas en este video:</h6>
                                    <div id="previewTechniques"></div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Confirmation Modal -->
                <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar EliminaciÃ³n</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                Â¿EstÃ¡s seguro de que deseas eliminar este video? Esta acciÃ³n no se puede deshacer.
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let allVideos = [];
        let currentSearchTerm = '';
        let currentCategory = 'all';
        let currentDifficulty = 'all';
        let previewModal;
        let confirmDeleteModal;
        let videoToDelete = null;
        let activeVideoTimer = null;
        let viewMode = 'grid';
        let selectedVideos = new Set();
        
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
            
            // Inicializar modales
            previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
            confirmDeleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            
            // Configurar formulario de videos
            const videoForm = document.getElementById('videoForm');
            videoForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveVideo();
            });
            
            // Configurar formulario de tÃ©cnicas
            const techniqueForm = document.getElementById('techniqueForm');
            techniqueForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveTechnique();
            });
            
            // Configurar botÃ³n de confirmaciÃ³n de eliminaciÃ³n
            document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
                if (videoToDelete) {
                    deleteVideo(videoToDelete);
                    videoToDelete = null;
                    confirmDeleteModal.hide();
                }
            });
            
            // Inicializar conversiÃ³n y validaciÃ³n de tiempo
            initTimeInputs();
            
            // Configurar filtros de categorÃ­as
            document.querySelectorAll('.category-pill').forEach(pill => {
                pill.addEventListener('click', function() {
                    // Si es filtro de categorÃ­a
                    if (this.hasAttribute('data-category')) {
                        document.querySelectorAll('.category-pill[data-category]').forEach(p => p.classList.remove('active'));
                        this.classList.add('active');
                        currentCategory = this.getAttribute('data-category');
                    }
                    
                    // Si es filtro de dificultad
                    if (this.hasAttribute('data-difficulty')) {
                        document.querySelectorAll('.category-pill[data-difficulty]').forEach(p => p.classList.remove('active'));
                        this.classList.add('active');
                        currentDifficulty = this.getAttribute('data-difficulty');
                    }
                });
            });
            
            // Monitorear cambios en formulario para vista previa
            document.getElementById('youtube_id').addEventListener('input', updateVideoPreview);
            document.getElementById('title').addEventListener('input', updateVideoPreview);
            document.getElementById('category').addEventListener('change', updateVideoPreview);
            document.getElementById('difficulty_level').addEventListener('change', updateVideoPreview);
            
            // Cargar videos al inicio
            fetchVideos();
            
            // Manejar cierre del modal
            document.getElementById('previewModal').addEventListener('hidden.bs.modal', function () {
                // Detener cualquier temporizador activo
                if (activeVideoTimer !== null) {
                    clearTimeout(activeVideoTimer);
                    activeVideoTimer = null;
                }
                
                // Detener la reproducciÃ³n del video
                document.getElementById('previewIframe').src = '';
                
                // Quitar resaltados
                resetTechniqueHighlights();
            });
        });
        
        // FunciÃ³n para actualizar vista previa del video
        function updateVideoPreview() {
            const youtubeId = document.getElementById('youtube_id').value.trim();
            const title = document.getElementById('title').value.trim();
            const category = document.getElementById('category').value;
            const difficultyLevel = document.getElementById('difficulty_level').value;
            
            // Actualizar miniatura
            const thumbnailPreview = document.getElementById('thumbnailPreview');
            
            if (youtubeId) {
                thumbnailPreview.style.backgroundImage = `url(https://img.youtube.com/vi/${youtubeId}/mqdefault.jpg)`;
                thumbnailPreview.innerHTML = '';
            } else {
                thumbnailPreview.style.backgroundImage = 'none';
                thumbnailPreview.innerHTML = `
                    <div class="d-flex justify-content-center align-items-center h-100">
                        <span class="text-muted">Ingresa el ID de YouTube para ver la miniatura</span>
                    </div>
                `;
            }
            
            // Actualizar datos del video
            const videoDataPreview = document.getElementById('videoDataPreview');
            
            if (title || youtubeId) {
                let difficultyBadge = '';
                switch(difficultyLevel) {
                    case 'beginner':
                        difficultyBadge = '<span class="badge bg-success">Principiante</span>';
                        break;
                    case 'intermediate':
                        difficultyBadge = '<span class="badge bg-warning text-dark">Intermedio</span>';
                        break;
                    case 'expert':
                        difficultyBadge = '<span class="badge bg-danger">Experto</span>';
                        break;
                }
                
                videoDataPreview.innerHTML = `
                    <h5>${title || 'Sin tÃ­tulo'}</h5>
                    <p class="text-muted">${youtubeId ? `YouTube ID: ${youtubeId}` : 'Sin ID de YouTube'}</p>
                    <div>
                        <span class="badge bg-secondary">${category}</span>
                        ${difficultyBadge}
                    </div>
                `;
            } else {
                videoDataPreview.innerHTML = `
                    <p class="text-muted">Ingresa la informaciÃ³n del video para ver una vista previa.</p>
                `;
            }
        }
        
        // FunciÃ³n para inicializar los campos de tiempo
        function initTimeInputs() {
            // Para el formulario de video principal
            const startTimeMin = document.getElementById('technique_start_time_min');
            const startTimeSec = document.getElementById('technique_start_time_sec');
            const endTimeMin = document.getElementById('technique_end_time_min');
            const endTimeSec = document.getElementById('technique_end_time_sec');
            const startTimeHidden = document.getElementById('technique_start_time');
            const endTimeHidden = document.getElementById('technique_end_time');
            
            // Eventos para convertir minutos:segundos a segundos totales
            [startTimeMin, startTimeSec].forEach(input => {
                input.addEventListener('input', () => {
                    validateAndUpdateTime(startTimeMin, startTimeSec, startTimeHidden);
                    validateTimeRange(startTimeMin, startTimeSec, endTimeMin, endTimeSec);
                });
            });
            
            [endTimeMin, endTimeSec].forEach(input => {
                input.addEventListener('input', () => {
                    validateAndUpdateTime(endTimeMin, endTimeSec, endTimeHidden);
                    validateTimeRange(startTimeMin, startTimeSec, endTimeMin, endTimeSec);
                });
            });
            
            // Para el formulario de tÃ©cnicas
            const techniqueStartMin = document.getElementById('technique_start_min');
            const techniqueStartSec = document.getElementById('technique_start_sec');
            const techniqueEndMin = document.getElementById('technique_end_min');
            const techniqueEndSec = document.getElementById('technique_end_sec');
            const techniqueStartHidden = document.getElementById('technique_start');
            const techniqueEndHidden = document.getElementById('technique_end');
            
            // Eventos para convertir minutos:segundos a segundos totales
            [techniqueStartMin, techniqueStartSec].forEach(input => {
                input.addEventListener('input', () => {
                    validateAndUpdateTime(techniqueStartMin, techniqueStartSec, techniqueStartHidden);
                    validateTimeRange(techniqueStartMin, techniqueStartSec, techniqueEndMin, techniqueEndSec);
                });
            });
            
            [techniqueEndMin, techniqueEndSec].forEach(input => {
                input.addEventListener('input', () => {
                    validateAndUpdateTime(techniqueEndMin, techniqueEndSec, techniqueEndHidden);
                    validateTimeRange(techniqueStartMin, techniqueStartSec, techniqueEndMin, techniqueEndSec);
                });
            });
        }

        // FunciÃ³n para validar y actualizar el tiempo en el campo oculto
        function validateAndUpdateTime(minInput, secInput, hiddenInput) {
            let minutes = parseInt(minInput.value) || 0;
            let seconds = parseInt(secInput.value) || 0;
            
            // Asegurarse de que los segundos estÃ©n en el rango 0-59
            if (seconds > 59) {
                seconds = 59;
                secInput.value = 59;
            }
            
            // Calcular tiempo total en segundos
            const totalSeconds = minutes * 60 + seconds;
            hiddenInput.value = totalSeconds;
        }

        // FunciÃ³n para validar que el tiempo final sea mayor que el inicial
        function validateTimeRange(startMinInput, startSecInput, endMinInput, endSecInput) {
            const startMin = parseInt(startMinInput.value) || 0;
            const startSec = parseInt(startSecInput.value) || 0;
            const endMin = parseInt(endMinInput.value) || 0;
            const endSec = parseInt(endSecInput.value) || 0;
            
            const startTotal = startMin * 60 + startSec;
            const endTotal = endMin * 60 + endSec;
            
            // Validar que el tiempo final sea mayor que el inicial
            if (endTotal <= startTotal && (endMinInput.value !== '' || endSecInput.value !== '')) {
                // Calcular un tiempo final vÃ¡lido (inicial + 10 segundos)
                let newEndTotal = startTotal + 10;
                const newEndMin = Math.floor(newEndTotal / 60);
                const newEndSec = newEndTotal % 60;
                
                endMinInput.value = newEndMin;
                endSecInput.value = newEndSec;
            }
        }

        // FunciÃ³n para convertir segundos a formato minutos:segundos y actualizar los campos
        function secondsToMinSec(seconds, minInput, secInput) {
            if (seconds === null || seconds === undefined || seconds === '') return;
            
            const totalSeconds = parseInt(seconds);
            const minutes = Math.floor(totalSeconds / 60);
            const remainingSeconds = totalSeconds % 60;
            
            minInput.value = minutes;
            secInput.value = remainingSeconds;
        }
        
        // FunciÃ³n para capturar el tiempo actual del video
        function captureCurrentTime() {
            // Obtener el iframe
            const iframe = document.getElementById('techniquesVideoPreview');
            
            // Esta funcionalidad requiere la API de YouTube
            // AquÃ­ se tendrÃ­a que implementar la comunicaciÃ³n con la API de YouTube
            // Para demostraciÃ³n, simplemente mostraremos un mensaje
            
            alert('Esta funcionalidad requiere la implementaciÃ³n de la API de YouTube Player. En una implementaciÃ³n real, capturarÃ­a el tiempo actual del video.');
        }
        
        // FunciÃ³n para reproducir un segmento de tÃ©cnica especÃ­fico
        function playTechniqueSegment(videoId, startTime, endTime) {
            // Detener cualquier temporizador activo
            if (activeVideoTimer !== null) {
                clearTimeout(activeVideoTimer);
                activeVideoTimer = null;
            }
            
            // Obtener el iframe del video
            const iframe = document.getElementById('previewIframe');
            if (iframe) {
                // Resaltar la tÃ©cnica actual si se pasÃ³ un elemento
                if (event && event.target) {
                    const techniqueElement = event.target.closest('.technique-item');
                    if (techniqueElement) {
                        highlightTechnique(techniqueElement);
                    }
                }
                
                // Actualizar la URL con los parÃ¡metros de tiempo y autoplay
                let newSrc = `https://www.youtube.com/embed/${videoId}?start=${startTime}&autoplay=1`;
                iframe.src = newSrc;
                
                // Mostrar el modal si no estÃ¡ visible
                if (!document.getElementById('previewModal').classList.contains('show')) {
                    previewModal.show();
                }
                
                // Calcular la duraciÃ³n de la tÃ©cnica
                const duration = endTime - startTime;
                
                // Configurar un temporizador para cerrar el video despuÃ©s de que termine la tÃ©cnica
                activeVideoTimer = setTimeout(() => {
                    // Resetear el video
                    iframe.src = '';
                    
                    // Cerrar el modal
                    previewModal.hide();
                    
                    // Quitar resaltado
                    resetTechniqueHighlights();
                    
                    // Limpiar el temporizador
                    activeVideoTimer = null;
                }, duration * 1000); // Convertir segundos a milisegundos
            }
        }
        
        // FunciÃ³n para resaltar la tÃ©cnica que se estÃ¡ reproduciendo
        function highlightTechnique(techniqueElement) {
            // Quitar el resaltado de todas las tÃ©cnicas
            resetTechniqueHighlights();
            
            // AÃ±adir clase de resaltado a la tÃ©cnica actual
            if (techniqueElement) {
                techniqueElement.classList.add('technique-highlight');
            }
        }
        
        // FunciÃ³n para quitar todos los resaltados de tÃ©cnicas
        function resetTechniqueHighlights() {
            document.querySelectorAll('.technique-item').forEach(el => {
                el.classList.remove('technique-highlight');
            });
        }
        
        // FunciÃ³n para establecer el modo de visualizaciÃ³n
        function setViewMode(mode) {
            viewMode = mode;
            const container = document.getElementById('videos-container');
            
            document.getElementById('gridViewBtn').classList.remove('active');
            document.getElementById('listViewBtn').classList.remove('active');
            
            if (mode === 'grid') {
                container.className = 'video-grid';
                document.getElementById('gridViewBtn').classList.add('active');
            } else {
                container.className = '';
                document.getElementById('listViewBtn').classList.add('active');
            }
            
            // Redibujar los videos
            displayVideos(allVideos);
        }
        
        // FunciÃ³n para limpiar todos los filtros
        function clearFilters() {
            currentSearchTerm = '';
            document.getElementById('searchInput').value = '';
            
            // Resetear categorÃ­as
            document.querySelectorAll('.category-pill[data-category]').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector('.category-pill[data-category="all"]').classList.add('active');
            currentCategory = 'all';
            
            // Resetear dificultad
            document.querySelectorAll('.category-pill[data-difficulty]').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector('.category-pill[data-difficulty="all"]').classList.add('active');
            currentDifficulty = 'all';
            
            // Resetear checkboxes
            document.getElementById('filterHasTechniques').checked = false;
            document.getElementById('filterNoTechniques').checked = false;
            
            // Limpiar filtros activos
            document.getElementById('activeFilters').innerHTML = '';
            
            // Resetear la vista
            displayVideos(allVideos);
        }
        
        // FunciÃ³n para aplicar los filtros actuales
        function applyFilters() {
            // Actualizar filtros activos
            updateActiveFilters();
            
            // Filtrar videos
            filterVideos();
            
            // Cerrar el collapsible de filtros avanzados
            const bsCollapse = bootstrap.Collapse.getInstance(document.getElementById('advancedFilters'));
            if (bsCollapse) {
                bsCollapse.hide();
            }
        }
        
        // FunciÃ³n para actualizar la visualizaciÃ³n de filtros activos
        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            activeFiltersContainer.innerHTML = '';
            
            // CategorÃ­a
            if (currentCategory !== 'all') {
                addFilterChip(activeFiltersContainer, 'CategorÃ­a: ' + currentCategory, () => {
                    document.querySelectorAll('.category-pill[data-category]').forEach(pill => {
                        pill.classList.remove('active');
                    });
                    document.querySelector('.category-pill[data-category="all"]').classList.add('active');
                    currentCategory = 'all';
                    filterVideos();
                });
            }
            
            // Dificultad
            if (currentDifficulty !== 'all') {
                let difficultyText;
                switch(currentDifficulty) {
                    case 'beginner': difficultyText = 'Principiante'; break;
                    case 'intermediate': difficultyText = 'Intermedio'; break;
                    case 'expert': difficultyText = 'Experto'; break;
                    default: difficultyText = currentDifficulty;
                }
                
                addFilterChip(activeFiltersContainer, 'Dificultad: ' + difficultyText, () => {
                    document.querySelectorAll('.category-pill[data-difficulty]').forEach(pill => {
                        pill.classList.remove('active');
                    });
                    document.querySelector('.category-pill[data-difficulty="all"]').classList.add('active');
                    currentDifficulty = 'all';
                    filterVideos();
                });
            }
            
            // Videos con tÃ©cnicas
            if (document.getElementById('filterHasTechniques').checked) {
                addFilterChip(activeFiltersContainer, 'Solo videos con tÃ©cnicas', () => {
                    document.getElementById('filterHasTechniques').checked = false;
                    filterVideos();
                });
            }
            
            // Videos sin tÃ©cnicas
            if (document.getElementById('filterNoTechniques').checked) {
                addFilterChip(activeFiltersContainer, 'Solo videos sin tÃ©cnicas', () => {
                    document.getElementById('filterNoTechniques').checked = false;
                    filterVideos();
                });
            }
            
            // TÃ©rmino de bÃºsqueda
            if (currentSearchTerm) {
                addFilterChip(activeFiltersContainer, 'BÃºsqueda: ' + currentSearchTerm, () => {
                    document.getElementById('searchInput').value = '';
                    currentSearchTerm = '';
                    filterVideos();
                });
            }
        }
        
        // FunciÃ³n para aÃ±adir un chip de filtro
        function addFilterChip(container, text, removeCallback) {
            const chip = document.createElement('div');
            chip.className = 'filter-chip';
            chip.innerHTML = `
                ${text}
                <span class="close" onclick="event.stopPropagation();">&times;</span>
            `;
            
            chip.querySelector('.close').addEventListener('click', () => {
                removeCallback();
                chip.remove();
            });
            
            container.appendChild(chip);
        }
        
        // FunciÃ³n para obtener todos los videos
        async function fetchVideos() {
            const container = document.getElementById('videos-container');
            container.innerHTML = `
                <div class="empty-message">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-3">Cargando videos...</p>
                </div>
            `;
            
            try {
                console.log("Iniciando solicitud a /api/videos");
                const response = await fetch('/api/videos');
                console.log("Respuesta recibida:", response.status);
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                console.log(`Videos cargados: ${data.length}`);
                
                // Actualizar la variable global
                allVideos = data;
                
                // Actualizar contador
                if (document.getElementById('videoCount')) {
                    document.getElementById('videoCount').textContent = data.length;
                }
                
                // Mostrar videos
                displayVideos(data);
                
            } catch (error) {
                console.error('Error al cargar videos:', error);
                container.innerHTML = `
                    <div class="empty-message">
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle me-2"></i> Error al cargar los videos: ${error.message}
                        </div>
                        <button class="btn btn-primary mt-3" onclick="fetchVideos()">
                            <i class="bi bi-arrow-clockwise me-2"></i> Intentar de nuevo
                        </button>
                    </div>
                `;
            }
        }
        
        // FunciÃ³n para mostrar los videos en la pÃ¡gina
        function displayVideos(videos) {
            const container = document.getElementById('videos-container');
            container.innerHTML = '';
            
            if (videos.length === 0) {
                container.innerHTML = `
                    <div class="empty-message">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i> No se encontraron videos que coincidan con tu bÃºsqueda.
                        </div>
                        <button class="btn btn-outline-secondary mt-3" onclick="clearFilters()">
                            <i class="bi bi-funnel me-2"></i> Limpiar filtros
                        </button>
                    </div>
                `;
                return;
            }
            
            if (viewMode === 'grid') {
                displayVideosAsGrid(videos, container);
            } else {
                displayVideosAsList(videos, container);
            }
        }
        
        // FunciÃ³n para mostrar videos en formato de cuadrÃ­cula
        function displayVideosAsGrid(videos, container) {
            videos.forEach(video => {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-container';
                videoCard.setAttribute('data-id', video.id);
                
                // Badge para dificultad
                let difficultyText, difficultyClass;
                switch(video.difficulty_level) {
                    case 'beginner':
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                        break;
                    case 'intermediate':
                        difficultyText = 'Intermedio';
                        difficultyClass = 'badge-intermediate';
                        break;
                    case 'expert':
                        difficultyText = 'Experto';
                        difficultyClass = 'badge-expert';
                        break;
                    default:
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                }
                
                // Determinar si tiene tÃ©cnicas
                const hasTechniques = video.techniques && video.techniques.length > 0;
                
                videoCard.innerHTML = `
                    <div class="position-relative">
                        <div class="youtube-container">
                            <iframe src="https://www.youtube.com/embed/${video.video_id}" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="video-actions">
                            <i class="bi bi-eye action-icon" onclick="openPreview('${video.video_id}', ${video.id})" data-bs-toggle="tooltip" title="Vista previa"></i>
                            <i class="bi bi-pencil action-icon" onclick="editVideo(${video.id})" data-bs-toggle="tooltip" title="Editar"></i>
                            <i class="bi bi-trash action-icon" onclick="confirmDelete(${video.id})" data-bs-toggle="tooltip" title="Eliminar"></i>
                            <i class="bi bi-list-check action-icon" onclick="goToTechniques(${video.id})" data-bs-toggle="tooltip" title="Gestionar tÃ©cnicas"></i>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <div class="video-title">${video.title}</div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" class="video-selector form-check-input" onclick="toggleVideoSelection(${video.id})">
                        </div>
                    </div>
                    <div>
                        <span class="badge bg-secondary">${video.category || 'Sin categorÃ­a'}</span>
                        <span class="badge ${difficultyClass}">${difficultyText}</span>
                        ${hasTechniques ? '<span class="badge bg-info ms-1"><i class="bi bi-check-circle me-1"></i> ' + video.techniques.length + ' tÃ©cnicas</span>' : ''}
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">Canal: ${video.channel || 'No especificado'}</small>
                    </div>
                `;
                
                container.appendChild(videoCard);
            });
            
            // Inicializar tooltips para las acciones
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            });
        }
        
        // FunciÃ³n para mostrar videos en formato de lista
// FunciÃ³n para mostrar videos en formato de lista
function displayVideosAsList(videos, container) {
            const table = document.createElement('table');
            table.className = 'table table-striped table-hover';
            
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th><input type="checkbox" class="form-check-input" id="selectAllVideos" onclick="toggleAllVideos()"></th>
                    <th>Miniatura</th>
                    <th>TÃ­tulo</th>
                    <th>CategorÃ­a</th>
                    <th>Dificultad</th>
                    <th>TÃ©cnicas</th>
                    <th>Acciones</th>
                </tr>
            `;
            
            const tbody = document.createElement('tbody');
            
            videos.forEach(video => {
                // Badge para dificultad
                let difficultyText, difficultyClass;
                switch(video.difficulty_level) {
                    case 'beginner':
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                        break;
                    case 'intermediate':
                        difficultyText = 'Intermedio';
                        difficultyClass = 'badge-intermediate';
                        break;
                    case 'expert':
                        difficultyText = 'Experto';
                        difficultyClass = 'badge-expert';
                        break;
                    default:
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                }
                
                // Determinar si tiene tÃ©cnicas
                const hasTechniques = video.techniques && video.techniques.length > 0;
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', video.id);
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="form-check-input video-selector" onclick="toggleVideoSelection(${video.id})">
                    </td>
                    <td>
                        <img src="https://img.youtube.com/vi/${video.video_id}/mqdefault.jpg" alt="${video.title}" style="width: 120px; border-radius: 4px;">
                    </td>
                    <td>
                        <strong>${video.title}</strong>
                        <div class="small text-muted">ID: ${video.video_id}</div>
                        <div class="small text-muted">Canal: ${video.channel || 'No especificado'}</div>
                    </td>
                    <td><span class="badge bg-secondary">${video.category || 'Sin categorÃ­a'}</span></td>
                    <td><span class="badge ${difficultyClass}">${difficultyText}</span></td>
                    <td>
                        ${hasTechniques ? '<span class="badge bg-info">' + video.techniques.length + ' tÃ©cnicas</span>' : '<span class="text-muted">Sin tÃ©cnicas</span>'}
                    </td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary" onclick="openPreview('${video.video_id}', ${video.id})" title="Vista previa">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="editVideo(${video.id})" title="Editar">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="goToTechniques(${video.id})" title="TÃ©cnicas">
                                <i class="bi bi-list-check"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete(${video.id})" title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }
        
        // FunciÃ³n para seleccionar/deseleccionar un video
        function toggleVideoSelection(videoId) {
            if (selectedVideos.has(videoId)) {
                selectedVideos.delete(videoId);
            } else {
                selectedVideos.add(videoId);
            }
            
            updateBatchActions();
        }
        
        // FunciÃ³n para seleccionar/deseleccionar todos los videos
        function toggleAllVideos() {
            const selectAllCheckbox = document.getElementById('selectAllVideos');
            const videoCheckboxes = document.querySelectorAll('.video-selector');
            
            if (selectAllCheckbox.checked) {
                // Seleccionar todos
                videoCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    const videoId = parseInt(checkbox.closest('[data-id]').getAttribute('data-id'));
                    selectedVideos.add(videoId);
                });
            } else {
                // Deseleccionar todos
                videoCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedVideos.clear();
            }
            
            updateBatchActions();
        }
        
        // FunciÃ³n para actualizar acciones por lote
        function updateBatchActions() {
            const batchActions = document.getElementById('batchActions');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedVideos.size;
            
            if (selectedVideos.size > 0) {
                batchActions.style.display = 'block';
            } else {
                batchActions.style.display = 'none';
            }
        }
        
        // FunciÃ³n para limpiar la selecciÃ³n
        function clearSelection() {
            selectedVideos.clear();
            
            // Desmarcar todos los checkboxes
            document.querySelectorAll('.video-selector').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Ocultar acciones por lote
            document.getElementById('batchActions').style.display = 'none';
        }
        
        // FunciÃ³n para eliminar videos seleccionados
        function deleteSelectedVideos() {
            if (selectedVideos.size === 0) return;
            
            if (confirm(`Â¿EstÃ¡s seguro de que deseas eliminar ${selectedVideos.size} videos? Esta acciÃ³n no se puede deshacer.`)) {
                // Convertir Set a Array para iterar
                const videosToDelete = Array.from(selectedVideos);
                
                // Contador para seguimiento
                let deleted = 0;
                let errors = 0;
                
                // FunciÃ³n para eliminar un video y continuar con el siguiente
                const deleteNext = (index) => {
                    if (index >= videosToDelete.length) {
                        // Todos los videos procesados
                        fetchVideos();
                        clearSelection();
                        alert(`EliminaciÃ³n completada: ${deleted} videos eliminados, ${errors} errores.`);
                        return;
                    }
                    
                    const videoId = videosToDelete[index];
                    
                    fetch(`/admin/videos/${videoId}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (response.ok) {
                            deleted++;
                        } else {
                            errors++;
                            console.error(`Error al eliminar video ID ${videoId}`);
                        }
                        // Continuar con el siguiente video
                        deleteNext(index + 1);
                    })
                    .catch(error => {
                        errors++;
                        console.error(`Error al eliminar video ID ${videoId}:`, error);
                        // Continuar con el siguiente video
                        deleteNext(index + 1);
                    });
                };
                
                // Comenzar el proceso de eliminaciÃ³n
                deleteNext(0);
            }
        }
        
        // FunciÃ³n para filtrar videos
        function filterVideos() {
            let filteredVideos = [...allVideos];
            
            // Filtrar por tÃ©rmino de bÃºsqueda
            if (currentSearchTerm) {
                filteredVideos = filteredVideos.filter(video => {
                    return (
                        (video.title && video.title.toLowerCase().includes(currentSearchTerm)) ||
                        (video.description && video.description.toLowerCase().includes(currentSearchTerm)) ||
                        (video.channel && video.channel.toLowerCase().includes(currentSearchTerm))
                    );
                });
            }
            
            // Filtrar por categorÃ­a
            if (currentCategory !== 'all') {
                filteredVideos = filteredVideos.filter(video => 
                    (video.category || 'Sin categorÃ­a') === currentCategory
                );
            }
            
            // Filtrar por dificultad
            if (currentDifficulty !== 'all') {
                filteredVideos = filteredVideos.filter(video => 
                    video.difficulty_level === currentDifficulty
                );
            }
            
            // Filtrar por videos con/sin tÃ©cnicas
            const filterHasTechniques = document.getElementById('filterHasTechniques').checked;
            const filterNoTechniques = document.getElementById('filterNoTechniques').checked;
            
            if (filterHasTechniques && !filterNoTechniques) {
                filteredVideos = filteredVideos.filter(video => 
                    video.techniques && video.techniques.length > 0
                );
            } else if (!filterHasTechniques && filterNoTechniques) {
                filteredVideos = filteredVideos.filter(video => 
                    !video.techniques || video.techniques.length === 0
                );
            }
            
            // Actualizar contador de videos
            if (document.getElementById('videoCount')) {
                document.getElementById('videoCount').textContent = filteredVideos.length;
            }
            
            // Mostrar videos filtrados
            displayVideos(filteredVideos);
        }
        
        // FunciÃ³n para buscar videos
        function searchVideos() {
            currentSearchTerm = document.getElementById('searchInput').value.toLowerCase();
            updateActiveFilters();
            filterVideos();
        }
        
        // FunciÃ³n para abrir vista previa
        async function openPreview(videoId, id) {
            const iframe = document.getElementById('previewIframe');
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
            
            // Cargar tÃ©cnicas
            try {
                const response = await fetch(`/api/videos/${id}/techniques`);
                if (!response.ok) {
                    throw new Error('Error al cargar tÃ©cnicas');
                }
                
                const techniques = await response.json();
                const techniquesList = document.getElementById('previewTechniques');
                
                if (techniques.length === 0) {
                    techniquesList.innerHTML = '<div class="alert alert-info">No hay tÃ©cnicas registradas para este video.</div>';
                } else {
                    techniquesList.innerHTML = '';
                    techniques.forEach(technique => {
                        const startTime = formatTime(technique.start_time);
                        const endTime = formatTime(technique.end_time);
                        
                        const item = document.createElement('div');
                        item.className = 'technique-item';
                        item.innerHTML = `
                            <div class="technique-content">
                                <strong>${technique.name}</strong> - 
                                <span class="time-selector" onclick="playTechniqueSegment('${videoId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                    <i class="bi bi-clock"></i> <span class="time-text">${startTime} - ${endTime}</span>
                                </span>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="playTechniqueSegment('${videoId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-play-fill"></i> Ver tÃ©cnica
                            </button>
                        `;
                        
                        techniquesList.appendChild(item);
                    });
                }
                
                previewModal.show();
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('previewTechniques').innerHTML = 
                    `<div class="alert alert-danger">Error al cargar tÃ©cnicas: ${error.message}</div>`;
                previewModal.show();
            }
        }
        
        // FunciÃ³n para navegar a la pestaÃ±a de tÃ©cnicas
        function goToTechniques(videoId) {
            // Guardar el ID del video
            document.getElementById('technique_video_id').value = videoId;
            
            // Cargar las tÃ©cnicas del video
            loadTechniques(videoId);
            
            // Mostrar la pestaÃ±a de tÃ©cnicas
            document.getElementById('techniques-tab').style.display = 'block';
            document.getElementById('techniques-tab').click();
            
            // Cargar el video para la vista previa
            loadVideoForTechniques(videoId);
        }
        
        // FunciÃ³n para cargar el video en la pestaÃ±a de tÃ©cnicas
        async function loadVideoForTechniques(videoId) {
            try {
                const response = await fetch(`/admin/videos/${videoId}`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                
                const video = await response.json();
                
                // Actualizar tÃ­tulo del video
                document.getElementById('videoTitleDisplay').textContent = video.title;
                
                // Cargar el iframe
                const iframe = document.getElementById('techniquesVideoPreview');
                iframe.src = `https://www.youtube.com/embed/${video.video_id}`;
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al cargar el video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para formatear tiempo en segundos a MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // FunciÃ³n para volver a la pestaÃ±a de videos
        function goBackToVideos() {
            document.getElementById('video-list-tab').click();
            document.getElementById('techniques-tab').style.display = 'none';
        }
        
        // FunciÃ³n para finalizar la ediciÃ³n de tÃ©cnicas
        function finishEditingTechniques() {
            // Ocultar la pestaÃ±a de tÃ©cnicas
            document.getElementById('techniques-tab').style.display = 'none';
            
            // Volver a la pestaÃ±a de videos
            document.getElementById('video-list-tab').click();
            
            // Recargar los videos para reflejar los cambios
            fetchVideos();
        }
        
        // FunciÃ³n para confirmar eliminaciÃ³n
        function confirmDelete(id) {
            videoToDelete = id;
            confirmDeleteModal.show();
        }
        
        // FunciÃ³n para eliminar video
        async function deleteVideo(id) {
            try {
                const response = await fetch(`/admin/videos/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Error al eliminar el video');
                }
                
                // Recargar lista de videos
                fetchVideos();
                
                // Mostrar mensaje de Ã©xito
                alert('Video eliminado correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al eliminar el video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para editar video
        async function editVideo(id) {
            try {
                const response = await fetch(`/admin/videos/${id}`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                
                const video = await response.json();
                
                // Cambiar a la pestaÃ±a de aÃ±adir/editar
                document.getElementById('add-video-tab').click();
                
                // Llenar formulario
                document.getElementById('video_id_edit').value = video.id;
                document.getElementById('title').value = video.title;
                document.getElementById('youtube_id').value = video.video_id;
                document.getElementById('description').value = video.description || '';
                document.getElementById('channel').value = video.channel || '';
                document.getElementById('category').value = video.category || 'Sin categorÃ­a';
                document.getElementById('difficulty_level').value = video.difficulty_level || 'beginner';
                
                // Actualizar los campos de tiempo en formato MM:SS
                const startTimeMin = document.getElementById('technique_start_time_min');
                const startTimeSec = document.getElementById('technique_start_time_sec');
                const endTimeMin = document.getElementById('technique_end_time_min');
                const endTimeSec = document.getElementById('technique_end_time_sec');
                const startTimeHidden = document.getElementById('technique_start_time');
                const endTimeHidden = document.getElementById('technique_end_time');
                
                // Convertir segundos a formato MM:SS
                if (video.technique_start_time !== null && video.technique_start_time !== undefined) {
                    secondsToMinSec(video.technique_start_time, startTimeMin, startTimeSec);
                    startTimeHidden.value = video.technique_start_time;
                }
                
                if (video.technique_end_time !== null && video.technique_end_time !== undefined) {
                    secondsToMinSec(video.technique_end_time, endTimeMin, endTimeSec);
                    endTimeHidden.value = video.technique_end_time;
                }
                
                // Actualizar vista previa
                updateVideoPreview();
                
                // Cambiar texto del formulario
                document.getElementById('form-title').textContent = 'Editar Video';
                document.getElementById('submit-btn').textContent = 'Actualizar Video';
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al cargar datos del video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para cargar tÃ©cnicas de un video
        async function loadTechniques(videoId) {
            try {
                const response = await fetch(`/api/videos/${videoId}/techniques`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar tÃ©cnicas');
                }
                
                const techniques = await response.json();
                const techniquesList = document.getElementById('techniques-list');
                
                if (techniques.length === 0) {
                    techniquesList.innerHTML = '<div class="alert alert-info">No hay tÃ©cnicas asociadas a este video.</div>';
                    return;
                }
                
                // Obtener primero los datos del video para tener el ID de YouTube
                const videoResponse = await fetch(`/admin/videos/${videoId}`);
                if (!videoResponse.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                const videoData = await videoResponse.json();
                const videoYoutubeId = videoData.video_id;
                
                techniquesList.innerHTML = '';
                
                // Ahora recorremos las tÃ©cnicas para mostrarlas
                for (const technique of techniques) {
                    const item = document.createElement('div');
                    item.className = 'technique-item';
                    
                    const startTime = formatTime(technique.start_time);
                    const endTime = formatTime(technique.end_time);
                    
                    item.innerHTML = `
                        <div class="technique-content">
                            <strong>${technique.name}</strong> - 
                            <span class="time-selector" onclick="playSegmentInTechniquesTab('${videoYoutubeId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-clock"></i> <span class="time-text">${startTime} - ${endTime}</span>
                            </span>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="playSegmentInTechniquesTab('${videoYoutubeId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-play-fill"></i> Ver
                            </button>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editTechnique(${technique.id}, '${technique.name}', ${technique.start_time}, ${technique.end_time})">
                                    <i class="bi bi-pencil"></i> Editar
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteTechnique(${technique.id})">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    techniquesList.appendChild(item);
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('techniques-list').innerHTML = 
                    `<div class="alert alert-danger">Error al cargar tÃ©cnicas: ${error.message}</div>`;
            }
        }
        
        // FunciÃ³n para reproducir un segmento en la pestaÃ±a de tÃ©cnicas
        function playSegmentInTechniquesTab(videoId, startTime, endTime) {
            const iframe = document.getElementById('techniquesVideoPreview');
            iframe.src = `https://www.youtube.com/embed/${videoId}?start=${startTime}&autoplay=1`;
            
            // Mostrar informaciÃ³n del tiempo
            document.getElementById('techniqueTiming').innerHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-play-fill me-2"></i> Reproduciendo desde ${formatTime(startTime)} hasta ${formatTime(endTime)}
                </div>
            `;
        }
        
        // FunciÃ³n para editar tÃ©cnica
        function editTechnique(id, name, startTime, endTime) {
            document.getElementById('technique_id_edit').value = id;
            document.getElementById('technique_name').value = name;
            
            // Convertir segundos a formato MM:SS
            const startMin = document.getElementById('technique_start_min');
            const startSec = document.getElementById('technique_start_sec');
            const endMin = document.getElementById('technique_end_min');
            const endSec = document.getElementById('technique_end_sec');
            const startHidden = document.getElementById('technique_start');
            const endHidden = document.getElementById('technique_end');
            
            secondsToMinSec(startTime, startMin, startSec);
            secondsToMinSec(endTime, endMin, endSec);
            
            startHidden.value = startTime;
            endHidden.value = endTime;
            
            // Cambiar texto del botÃ³n
            document.getElementById('technique-submit-btn').textContent = 'Actualizar TÃ©cnica';
            
            // Desplazarse al formulario
            document.getElementById('techniqueForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // FunciÃ³n para eliminar tÃ©cnica
        async function deleteTechnique(id) {
            if (!confirm('Â¿EstÃ¡s seguro de que deseas eliminar esta tÃ©cnica?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/techniques/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Error al eliminar la tÃ©cnica');
                }
                
                // Recargar tÃ©cnicas
                const videoId = document.getElementById('technique_video_id').value;
                loadTechniques(videoId);
                
                // Mostrar mensaje de Ã©xito
                alert('TÃ©cnica eliminada correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al eliminar la tÃ©cnica: ${error.message}`);
            }
        }
        
        // FunciÃ³n para guardar/actualizar video
        async function saveVideo() {
            const videoId = document.getElementById('video_id_edit').value;
            const isEdit = videoId !== '';
            
            // Extraer el ID de YouTube de la URL
            let youtubeInputValue = document.getElementById('youtube_id').value.trim();
            let youtubeVideoId = youtubeInputValue;
            
            // Si es una URL completa, extraer solo el ID
            if (youtubeInputValue.includes('youtube.com/watch?v=')) {
                const url = new URL(youtubeInputValue);
                youtubeVideoId = url.searchParams.get('v');
            } else if (youtubeInputValue.includes('youtu.be/')) {
                youtubeVideoId = youtubeInputValue.split('youtu.be/')[1];
            }
            
            // Si hay parÃ¡metros adicionales despuÃ©s del ID, eliminarlos
            if (youtubeVideoId && youtubeVideoId.includes('&')) {
                youtubeVideoId = youtubeVideoId.split('&')[0];
            }
            
            const videoData = {
                title: document.getElementById('title').value,
                video_id: youtubeVideoId, // Usar el ID extraÃ­do en lugar de la URL completa
                description: document.getElementById('description').value,
                channel: document.getElementById('channel').value,
                category: document.getElementById('category').value,
                difficulty_level: document.getElementById('difficulty_level').value,
                technique_start_time: parseInt(document.getElementById('technique_start_time').value) || 0
            };
            
            const endTime = document.getElementById('technique_end_time').value;
            if (endTime) {
                videoData.technique_end_time = parseInt(endTime);
            }
            
            try {
                let url = '/admin/videos';
                let method = 'POST';
                
                if (isEdit) {
                    url = `/admin/videos/${videoId}`;
                    method = 'PUT';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(videoData)
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'Error al guardar el video');
                }
                
                const data = await response.json();
                
                // Si es un nuevo video, preguntar si quiere aÃ±adir tÃ©cnicas
                if (!isEdit && confirm('Video guardado correctamente. Â¿Deseas aÃ±adir tÃ©cnicas a este video ahora?')) {
                    goToTechniques(data.id);
                } else {
                    // Resetear formulario
                    resetForm();
                    
                    // Cambiar a la pestaÃ±a de videos
                    document.getElementById('video-list-tab').click();
                    
                    // Recargar lista de videos
                    fetchVideos();
                    
                    // Mostrar mensaje de Ã©xito
                    alert(isEdit ? 'Video actualizado correctamente' : 'Video guardado correctamente');
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }
        
        // FunciÃ³n para guardar/actualizar tÃ©cnica
        async function saveTechnique() {
            const techniqueId = document.getElementById('technique_id_edit').value;
            const videoId = document.getElementById('technique_video_id').value;
            const isEdit = techniqueId !== '';
            
            if (!videoId) {
                alert('Primero debes seleccionar un video');
                return;
            }
            
            const techniqueData = {
                name: document.getElementById('technique_name').value,
                start_time: parseInt(document.getElementById('technique_start').value),
                end_time: parseInt(document.getElementById('technique_end').value)
            };
            
            try {
                let url, method;
                
                if (isEdit) {
                    url = `/api/techniques/${techniqueId}`;
                    method = 'PUT';
                } else {
                    url = `/api/videos/${videoId}/techniques`;
                    method = 'POST';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(techniqueData)
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'Error al guardar la tÃ©cnica');
                }
                
                // Resetear formulario de tÃ©cnica
                resetTechniqueForm();
                
                // Recargar tÃ©cnicas
                loadTechniques(videoId);
                
                // Mostrar mensaje de Ã©xito
                alert(isEdit ? 'TÃ©cnica actualizada correctamente' : 'TÃ©cnica aÃ±adida correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }
        
        // FunciÃ³n para resetear formulario de video
        function resetForm() {
            document.getElementById('videoForm').reset();
            document.getElementById('video_id_edit').value = '';
            document.getElementById('form-title').textContent = 'AÃ±adir Nuevo Video';
            document.getElementById('submit-btn').textContent = 'Guardar Video';
            
            // Resetear vista previa
            document.getElementById('thumbnailPreview').style.backgroundImage = 'none';
            document.getElementById('thumbnailPreview').innerHTML = `
                <div class="d-flex justify-content-center align-items-center h-100">
                    <span class="text-muted">La miniatura se generarÃ¡ automÃ¡ticamente</span>
                </div>
            `;
            
            document.getElementById('videoDataPreview').innerHTML = `
                <p class="text-muted">Ingresa la informaciÃ³n del video para ver una vista previa.</p>
            `;
        }
        
        // FunciÃ³n para resetear formulario de tÃ©cnica
        function resetTechniqueForm() {
            document.getElementById('techniqueForm').reset();
            document.getElementById('technique_id_edit').value = '';
            document.getElementById('technique-submit-btn').textContent = 'AÃ±adir TÃ©cnica';
        }
    </script>
</body>
</html>        
// FunciÃ³n para mostrar videos en formato de lista
        function displayVideosAsList(videos, container) {
            const table = document.createElement('table');
            table.className = 'table table-striped table-hover';
            
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th><input type="checkbox" class="form-check-input" id="selectAllVideos" onclick="toggleAllVideos()"></th>
                    <th>Miniatura</th>
                    <th>TÃ­tulo</th>
                    <th>CategorÃ­a</th>
                    <th>Dificultad</th>
                    <th>TÃ©cnicas</th>
                    <th>Acciones</th>
                </tr>
            `;
            
            const tbody = document.createElement('tbody');
            
            videos.forEach(video => {
                // Badge para dificultad
                let difficultyText, difficultyClass;
                switch(video.difficulty_level) {
                    case 'beginner':
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                        break;
                    case 'intermediate':
                        difficultyText = 'Intermedio';
                        difficultyClass = 'badge-intermediate';
                        break;
                    case 'expert':
                        difficultyText = 'Experto';
                        difficultyClass = 'badge-expert';
                        break;
                    default:
                        difficultyText = 'Principiante';
                        difficultyClass = 'badge-beginner';
                }
                
                // Determinar si tiene tÃ©cnicas
                const hasTechniques = video.techniques && video.techniques.length > 0;
                
                const row = document.createElement('tr');
                row.setAttribute('data-id', video.id);
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="form-check-input video-selector" onclick="toggleVideoSelection(${video.id})">
                    </td>
                    <td>
                        <img src="https://img.youtube.com/vi/${video.video_id}/mqdefault.jpg" alt="${video.title}" style="width: 120px; border-radius: 4px;">
                    </td>
                    <td>
                        <strong>${video.title}</strong>
                        <div class="small text-muted">ID: ${video.video_id}</div>
                        <div class="small text-muted">Canal: ${video.channel || 'No especificado'}</div>
                    </td>
                    <td><span class="badge bg-secondary">${video.category || 'Sin categorÃ­a'}</span></td>
                    <td><span class="badge ${difficultyClass}">${difficultyText}</span></td>
                    <td>
                        ${hasTechniques ? '<span class="badge bg-info">' + video.techniques.length + ' tÃ©cnicas</span>' : '<span class="text-muted">Sin tÃ©cnicas</span>'}
                    </td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-primary" onclick="openPreview('${video.video_id}', ${video.id})" title="Vista previa">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="editVideo(${video.id})" title="Editar">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="goToTechniques(${video.id})" title="TÃ©cnicas">
                                <i class="bi bi-list-check"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete(${video.id})" title="Eliminar">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }
        
        // FunciÃ³n para seleccionar/deseleccionar un video
        function toggleVideoSelection(videoId) {
            if (selectedVideos.has(videoId)) {
                selectedVideos.delete(videoId);
            } else {
                selectedVideos.add(videoId);
            }
            
            updateBatchActions();
        }
        
        // FunciÃ³n para seleccionar/deseleccionar todos los videos
        function toggleAllVideos() {
            const selectAllCheckbox = document.getElementById('selectAllVideos');
            const videoCheckboxes = document.querySelectorAll('.video-selector');
            
            if (selectAllCheckbox.checked) {
                // Seleccionar todos
                videoCheckboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    const videoId = parseInt(checkbox.closest('[data-id]').getAttribute('data-id'));
                    selectedVideos.add(videoId);
                });
            } else {
                // Deseleccionar todos
                videoCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedVideos.clear();
            }
            
            updateBatchActions();
        }
        
        // FunciÃ³n para actualizar acciones por lote
        function updateBatchActions() {
            const batchActions = document.getElementById('batchActions');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedVideos.size;
            
            if (selectedVideos.size > 0) {
                batchActions.style.display = 'block';
            } else {
                batchActions.style.display = 'none';
            }
        }
        
        // FunciÃ³n para limpiar la selecciÃ³n
        function clearSelection() {
            selectedVideos.clear();
            
            // Desmarcar todos los checkboxes
            document.querySelectorAll('.video-selector').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Ocultar acciones por lote
            document.getElementById('batchActions').style.display = 'none';
        }
        
        // FunciÃ³n para eliminar videos seleccionados
        function deleteSelectedVideos() {
            if (selectedVideos.size === 0) return;
            
            if (confirm(`Â¿EstÃ¡s seguro de que deseas eliminar ${selectedVideos.size} videos? Esta acciÃ³n no se puede deshacer.`)) {
                // Convertir Set a Array para iterar
                const videosToDelete = Array.from(selectedVideos);
                
                // Contador para seguimiento
                let deleted = 0;
                let errors = 0;
                
                // FunciÃ³n para eliminar un video y continuar con el siguiente
                const deleteNext = (index) => {
                    if (index >= videosToDelete.length) {
                        // Todos los videos procesados
                        fetchVideos();
                        clearSelection();
                        alert(`EliminaciÃ³n completada: ${deleted} videos eliminados, ${errors} errores.`);
                        return;
                    }
                    
                    const videoId = videosToDelete[index];
                    
                    fetch(`/admin/videos/${videoId}`, {
                        method: 'DELETE'
                    })
                    .then(response => {
                        if (response.ok) {
                            deleted++;
                        } else {
                            errors++;
                            console.error(`Error al eliminar video ID ${videoId}`);
                        }
                        // Continuar con el siguiente video
                        deleteNext(index + 1);
                    })
                    .catch(error => {
                        errors++;
                        console.error(`Error al eliminar video ID ${videoId}:`, error);
                        // Continuar con el siguiente video
                        deleteNext(index + 1);
                    });
                };
                
                // Comenzar el proceso de eliminaciÃ³n
                deleteNext(0);
            }
        }
        
        // FunciÃ³n para filtrar videos
        function filterVideos() {
            let filteredVideos = [...allVideos];
            
            // Filtrar por tÃ©rmino de bÃºsqueda
            if (currentSearchTerm) {
                filteredVideos = filteredVideos.filter(video => {
                    return (
                        (video.title && video.title.toLowerCase().includes(currentSearchTerm)) ||
                        (video.description && video.description.toLowerCase().includes(currentSearchTerm)) ||
                        (video.channel && video.channel.toLowerCase().includes(currentSearchTerm))
                    );
                });
            }
            
            // Filtrar por categorÃ­a
            if (currentCategory !== 'all') {
                filteredVideos = filteredVideos.filter(video => 
                    (video.category || 'Sin categorÃ­a') === currentCategory
                );
            }
            
            // Filtrar por dificultad
            if (currentDifficulty !== 'all') {
                filteredVideos = filteredVideos.filter(video => 
                    video.difficulty_level === currentDifficulty
                );
            }
            
            // Filtrar por videos con/sin tÃ©cnicas
            const filterHasTechniques = document.getElementById('filterHasTechniques').checked;
            const filterNoTechniques = document.getElementById('filterNoTechniques').checked;
            
            if (filterHasTechniques && !filterNoTechniques) {
                filteredVideos = filteredVideos.filter(video => 
                    video.techniques && video.techniques.length > 0
                );
            } else if (!filterHasTechniques && filterNoTechniques) {
                filteredVideos = filteredVideos.filter(video => 
                    !video.techniques || video.techniques.length === 0
                );
            }
            
            // Actualizar contador de videos
            if (document.getElementById('videoCount')) {
                document.getElementById('videoCount').textContent = filteredVideos.length;
            }
            
            // Mostrar videos filtrados
            displayVideos(filteredVideos);
        }
        
        // FunciÃ³n para buscar videos
        function searchVideos() {
            currentSearchTerm = document.getElementById('searchInput').value.toLowerCase();
            updateActiveFilters();
            filterVideos();
        }
        
        // FunciÃ³n para abrir vista previa
        async function openPreview(videoId, id) {
            const iframe = document.getElementById('previewIframe');
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
            
            // Cargar tÃ©cnicas
            try {
                const response = await fetch(`/api/videos/${id}/techniques`);
                if (!response.ok) {
                    throw new Error('Error al cargar tÃ©cnicas');
                }
                
                const techniques = await response.json();
                const techniquesList = document.getElementById('previewTechniques');
                
                if (techniques.length === 0) {
                    techniquesList.innerHTML = '<div class="alert alert-info">No hay tÃ©cnicas registradas para este video.</div>';
                } else {
                    techniquesList.innerHTML = '';
                    techniques.forEach(technique => {
                        const startTime = formatTime(technique.start_time);
                        const endTime = formatTime(technique.end_time);
                        
                        const item = document.createElement('div');
                        item.className = 'technique-item';
                        item.innerHTML = `
                            <div class="technique-content">
                                <strong>${technique.name}</strong> - 
                                <span class="time-selector" onclick="playTechniqueSegment('${videoId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                    <i class="bi bi-clock"></i> <span class="time-text">${startTime} - ${endTime}</span>
                                </span>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="playTechniqueSegment('${videoId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-play-fill"></i> Ver tÃ©cnica
                            </button>
                        `;
                        
                        techniquesList.appendChild(item);
                    });
                }
                
                previewModal.show();
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('previewTechniques').innerHTML = 
                    `<div class="alert alert-danger">Error al cargar tÃ©cnicas: ${error.message}</div>`;
                previewModal.show();
            }
        }
        
        // FunciÃ³n para navegar a la pestaÃ±a de tÃ©cnicas
        function goToTechniques(videoId) {
            // Guardar el ID del video
            document.getElementById('technique_video_id').value = videoId;
            
            // Cargar las tÃ©cnicas del video
            loadTechniques(videoId);
            
            // Mostrar la pestaÃ±a de tÃ©cnicas
            document.getElementById('techniques-tab').style.display = 'block';
            document.getElementById('techniques-tab').click();
            
            // Cargar el video para la vista previa
            loadVideoForTechniques(videoId);
        }
        
        // FunciÃ³n para cargar el video en la pestaÃ±a de tÃ©cnicas
        async function loadVideoForTechniques(videoId) {
            try {
                const response = await fetch(`/admin/videos/${videoId}`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                
                const video = await response.json();
                
                // Actualizar tÃ­tulo del video
                document.getElementById('videoTitleDisplay').textContent = video.title;
                
                // Cargar el iframe
                const iframe = document.getElementById('techniquesVideoPreview');
                iframe.src = `https://www.youtube.com/embed/${video.video_id}`;
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al cargar el video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para formatear tiempo en segundos a MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // FunciÃ³n para volver a la pestaÃ±a de videos
        function goBackToVideos() {
            document.getElementById('video-list-tab').click();
            document.getElementById('techniques-tab').style.display = 'none';
        }
        
        // FunciÃ³n para finalizar la ediciÃ³n de tÃ©cnicas
        function finishEditingTechniques() {
            // Ocultar la pestaÃ±a de tÃ©cnicas
            document.getElementById('techniques-tab').style.display = 'none';
            
            // Volver a la pestaÃ±a de videos
            document.getElementById('video-list-tab').click();
            
            // Recargar los videos para reflejar los cambios
            fetchVideos();
        }
        
        // FunciÃ³n para confirmar eliminaciÃ³n
        function confirmDelete(id) {
            videoToDelete = id;
            confirmDeleteModal.show();
        }
        
        // FunciÃ³n para eliminar video
        async function deleteVideo(id) {
            try {
                const response = await fetch(`/admin/videos/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Error al eliminar el video');
                }
                
                // Recargar lista de videos
                fetchVideos();
                
                // Mostrar mensaje de Ã©xito
                alert('Video eliminado correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al eliminar el video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para editar video
        async function editVideo(id) {
            try {
                const response = await fetch(`/admin/videos/${id}`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                
                const video = await response.json();
                
                // Cambiar a la pestaÃ±a de aÃ±adir/editar
                document.getElementById('add-video-tab').click();
                
                // Llenar formulario
                document.getElementById('video_id_edit').value = video.id;
                document.getElementById('title').value = video.title;
                document.getElementById('youtube_id').value = video.video_id;
                document.getElementById('description').value = video.description || '';
                document.getElementById('channel').value = video.channel || '';
                document.getElementById('category').value = video.category || 'Sin categorÃ­a';
                document.getElementById('difficulty_level').value = video.difficulty_level || 'beginner';
                
                // Actualizar los campos de tiempo en formato MM:SS
                const startTimeMin = document.getElementById('technique_start_time_min');
                const startTimeSec = document.getElementById('technique_start_time_sec');
                const endTimeMin = document.getElementById('technique_end_time_min');
                const endTimeSec = document.getElementById('technique_end_time_sec');
                const startTimeHidden = document.getElementById('technique_start_time');
                const endTimeHidden = document.getElementById('technique_end_time');
                
                // Convertir segundos a formato MM:SS
                if (video.technique_start_time !== null && video.technique_start_time !== undefined) {
                    secondsToMinSec(video.technique_start_time, startTimeMin, startTimeSec);
                    startTimeHidden.value = video.technique_start_time;
                }
                
                if (video.technique_end_time !== null && video.technique_end_time !== undefined) {
                    secondsToMinSec(video.technique_end_time, endTimeMin, endTimeSec);
                    endTimeHidden.value = video.technique_end_time;
                }
                
                // Actualizar vista previa
                updateVideoPreview();
                
                // Cambiar texto del formulario
                document.getElementById('form-title').textContent = 'Editar Video';
                document.getElementById('submit-btn').textContent = 'Actualizar Video';
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al cargar datos del video: ${error.message}`);
            }
        }
        
        // FunciÃ³n para cargar tÃ©cnicas de un video
        async function loadTechniques(videoId) {
            try {
                const response = await fetch(`/api/videos/${videoId}/techniques`);
                
                if (!response.ok) {
                    throw new Error('Error al cargar tÃ©cnicas');
                }
                
                const techniques = await response.json();
                const techniquesList = document.getElementById('techniques-list');
                
                if (techniques.length === 0) {
                    techniquesList.innerHTML = '<div class="alert alert-info">No hay tÃ©cnicas asociadas a este video.</div>';
                    return;
                }
                
                // Obtener primero los datos del video para tener el ID de YouTube
                const videoResponse = await fetch(`/admin/videos/${videoId}`);
                if (!videoResponse.ok) {
                    throw new Error('Error al cargar datos del video');
                }
                const videoData = await videoResponse.json();
                const videoYoutubeId = videoData.video_id;
                
                techniquesList.innerHTML = '';
                
                // Ahora recorremos las tÃ©cnicas para mostrarlas
                for (const technique of techniques) {
                    const item = document.createElement('div');
                    item.className = 'technique-item';
                    
                    const startTime = formatTime(technique.start_time);
                    const endTime = formatTime(technique.end_time);
                    
                    item.innerHTML = `
                        <div class="technique-content">
                            <strong>${technique.name}</strong> - 
                            <span class="time-selector" onclick="playSegmentInTechniquesTab('${videoYoutubeId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-clock"></i> <span class="time-text">${startTime} - ${endTime}</span>
                            </span>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="playSegmentInTechniquesTab('${videoYoutubeId}', ${technique.start_time}, ${technique.end_time}); highlightTechnique(this.closest('.technique-item'))">
                                <i class="bi bi-play-fill"></i> Ver
                            </button>
                            <div>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="editTechnique(${technique.id}, '${technique.name}', ${technique.start_time}, ${technique.end_time})">
                                    <i class="bi bi-pencil"></i> Editar
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteTechnique(${technique.id})">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    techniquesList.appendChild(item);
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('techniques-list').innerHTML = 
                    `<div class="alert alert-danger">Error al cargar tÃ©cnicas: ${error.message}</div>`;
            }
        }
        
        // FunciÃ³n para reproducir un segmento en la pestaÃ±a de tÃ©cnicas
        function playSegmentInTechniquesTab(videoId, startTime, endTime) {
            const iframe = document.getElementById('techniquesVideoPreview');
            iframe.src = `https://www.youtube.com/embed/${videoId}?start=${startTime}&autoplay=1`;
            
            // Mostrar informaciÃ³n del tiempo
            document.getElementById('techniqueTiming').innerHTML = `
                <div class="alert alert-success">
                    <i class="bi bi-play-fill me-2"></i> Reproduciendo desde ${formatTime(startTime)} hasta ${formatTime(endTime)}
                </div>
            `;
        }
        
        // FunciÃ³n para editar tÃ©cnica
        function editTechnique(id, name, startTime, endTime) {
            document.getElementById('technique_id_edit').value = id;
            document.getElementById('technique_name').value = name;
            
            // Convertir segundos a formato MM:SS
            const startMin = document.getElementById('technique_start_min');
            const startSec = document.getElementById('technique_start_sec');
            const endMin = document.getElementById('technique_end_min');
            const endSec = document.getElementById('technique_end_sec');
            const startHidden = document.getElementById('technique_start');
            const endHidden = document.getElementById('technique_end');
            
            secondsToMinSec(startTime, startMin, startSec);
            secondsToMinSec(endTime, endMin, endSec);
            
            startHidden.value = startTime;
            endHidden.value = endTime;
            
            // Cambiar texto del botÃ³n
            document.getElementById('technique-submit-btn').textContent = 'Actualizar TÃ©cnica';
            
            // Desplazarse al formulario
            document.getElementById('techniqueForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // FunciÃ³n para eliminar tÃ©cnica
        async function deleteTechnique(id) {
            if (!confirm('Â¿EstÃ¡s seguro de que deseas eliminar esta tÃ©cnica?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/techniques/${id}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Error al eliminar la tÃ©cnica');
                }
                
                // Recargar tÃ©cnicas
                const videoId = document.getElementById('technique_video_id').value;
                loadTechniques(videoId);
                
                // Mostrar mensaje de Ã©xito
                alert('TÃ©cnica eliminada correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error al eliminar la tÃ©cnica: ${error.message}`);
            }
        }
        
        // FunciÃ³n para guardar/actualizar video
        async function saveVideo() {
            const videoId = document.getElementById('video_id_edit').value;
            const isEdit = videoId !== '';
            
            // Extraer el ID de YouTube de la URL
            let youtubeInputValue = document.getElementById('youtube_id').value.trim();
            let youtubeVideoId = youtubeInputValue;
            
            // Si es una URL completa, extraer solo el ID
            if (youtubeInputValue.includes('youtube.com/watch?v=')) {
                const url = new URL(youtubeInputValue);
                youtubeVideoId = url.searchParams.get('v');
            } else if (youtubeInputValue.includes('youtu.be/')) {
                youtubeVideoId = youtubeInputValue.split('youtu.be/')[1];
            }
            
            // Si hay parÃ¡metros adicionales despuÃ©s del ID, eliminarlos
            if (youtubeVideoId && youtubeVideoId.includes('&')) {
                youtubeVideoId = youtubeVideoId.split('&')[0];
            }
            
            const videoData = {
                title: document.getElementById('title').value,
                video_id: youtubeVideoId, // Usar el ID extraÃ­do en lugar de la URL completa
                description: document.getElementById('description').value,
                channel: document.getElementById('channel').value,
                category: document.getElementById('category').value,
                difficulty_level: document.getElementById('difficulty_level').value,
                technique_start_time: parseInt(document.getElementById('technique_start_time').value) || 0
            };
            
            const endTime = document.getElementById('technique_end_time').value;
            if (endTime) {
                videoData.technique_end_time = parseInt(endTime);
            }
            
            try {
                let url = '/admin/videos';
                let method = 'POST';
                
                if (isEdit) {
                    url = `/admin/videos/${videoId}`;
                    method = 'PUT';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(videoData)
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'Error al guardar el video');
                }
                
                const data = await response.json();
                
                // Si es un nuevo video, preguntar si quiere aÃ±adir tÃ©cnicas
                if (!isEdit && confirm('Video guardado correctamente. Â¿Deseas aÃ±adir tÃ©cnicas a este video ahora?')) {
                    goToTechniques(data.id);
                } else {
                    // Resetear formulario
                    resetForm();
                    
                    // Cambiar a la pestaÃ±a de videos
                    document.getElementById('video-list-tab').click();
                    
                    // Recargar lista de videos
                    fetchVideos();
                    
                    // Mostrar mensaje de Ã©xito
                    alert(isEdit ? 'Video actualizado correctamente' : 'Video guardado correctamente');
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }
        
        // FunciÃ³n para guardar/actualizar tÃ©cnica
        async function saveTechnique() {
            const techniqueId = document.getElementById('technique_id_edit').value;
            const videoId = document.getElementById('technique_video_id').value;
            const isEdit = techniqueId !== '';
            
            if (!videoId) {
                alert('Primero debes seleccionar un video');
                return;
            }
            
            const techniqueData = {
                name: document.getElementById('technique_name').value,
                start_time: parseInt(document.getElementById('technique_start').value),
                end_time: parseInt(document.getElementById('technique_end').value)
            };
            
            try {
                let url, method;
                
                if (isEdit) {
                    url = `/api/techniques/${techniqueId}`;
                    method = 'PUT';
                } else {
                    url = `/api/videos/${videoId}/techniques`;
                    method = 'POST';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(techniqueData)
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.error || 'Error al guardar la tÃ©cnica');
                }
                
                // Resetear formulario de tÃ©cnica
                resetTechniqueForm();
                
                // Recargar tÃ©cnicas
                loadTechniques(videoId);
                
                // Mostrar mensaje de Ã©xito
                alert(isEdit ? 'TÃ©cnica actualizada correctamente' : 'TÃ©cnica aÃ±adida correctamente');
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
            }
        }
        
        // FunciÃ³n para resetear formulario de video
        function resetForm() {
            document.getElementById('videoForm').reset();
            document.getElementById('video_id_edit').value = '';
            document.getElementById('form-title').textContent = 'AÃ±adir Nuevo Video';
            document.getElementById('submit-btn').textContent = 'Guardar Video';
            
            // Resetear vista previa
            document.getElementById('thumbnailPreview').style.backgroundImage = 'none';
            document.getElementById('thumbnailPreview').innerHTML = `
                <div class="d-flex justify-content-center align-items-center h-100">
                    <span class="text-muted">La miniatura se generarÃ¡ automÃ¡ticamente</span>
                </div>
            `;
            
            document.getElementById('videoDataPreview').innerHTML = `
                <p class="text-muted">Ingresa la informaciÃ³n del video para ver una vista previa.</p>
            `;
        }
        
        // FunciÃ³n para resetear formulario de tÃ©cnica
        function resetTechniqueForm() {
            document.getElementById('techniqueForm').reset();
            document.getElementById('technique_id_edit').value = '';
            document.getElementById('technique-submit-btn').textContent = 'AÃ±adir TÃ©cnica';
        }
    </script>
</body>
</html>
